{
  "module_id": "step2_front_worldbuilder",
  "version": "4.0.0",
  "type": "TYPE_I_PIPELINE",
  "description": "Fase 2: Define a Ameaça, o Elenco de NPCs e o Desastre Iminente baseados no Arquétipo e Locais.",
  "configuration": {
    "model_preset": "@preset/lorandur-cli",
    "response_healing": true
  },
  "inputs_required": [
    "genre",
    "subgenres",
    "scope",
    "argumento",
    "step1_arquetipo",
    "step1_foco",
    "step1_locais",
    "premissas",
    "arquetipos_personagens_permitidos"
  ],
  "input_mapping": {
    "genre": "context.genre",
    "subgenres": "adventure.trama.configuracao_aventura.subgeneros_selecionados",
    "scope": "adventure.trama.configuracao_aventura.escopo",
    "argumento": "adventure.trama.argumento.texto",
    "step1_arquetipo": "adventure.front.step1.cabecalho.arquetipo_selecionado",
    "step1_foco": "adventure.front.step1.cabecalho.foco_narrativo",
    "step1_locais": "adventure.front.step1.lista_locais",
    "premissas": "adventure.trama.premissas",
    "arquetipos_personagens_permitidos": "context.available_archetypes_str"
  },
  "prompts": {
    "system": "Este documento contém a estrutura do prompt para a **Fase 2**, focada em povoar o mundo criado e definir os perigos ativos.\n\n# **PARTE 1: SYSTEM PROMPT**\n\nVocê é um Mestre de RPG especialista e Designer Narrativo.\n\n# **Objetivo**\n\nSua tarefa é dar vida à \"Frente de Aventura\". Utilizando o Arquétipo e os Locais definidos na fase anterior, você deve criar o **Elenco**, os **Perigos** ativos e definir o **Desastre Iminente**.\n\n# **Instruções de Processamento**\n\n1. **Definição do Contexto (Descrição):**\n   * Escreva um breve parágrafo de **Descrição** da Frente. Resuma o foco central do conflito, conectando o Arquétipo de Enredo à ameaça imediata.\n\n2. Criação do Elenco e Perigos:\n   O objetivo é criar ameaças vivas e dinâmicas, não apenas estátuas estáticas. Siga estritamente os passos abaixo:\n   * **Passo A: Elenco (The Cast):**\n     * Liste os NPCs e Organizações cruciais citados no Argumento.\n     * Dê a cada um: **Nome**, **Papel/Função** e um **Detalhe Marcante** (algo visual ou de personalidade). *Use a lista de `arquetipos_personagens_permitidos` para inspiração.*\n   * **Passo B: Perigos (Dangers):**\n     * Crie 2 ou 3 ameaças ativas que se opõem aos jogadores.\n     * Para cada Perigo, selecione um **Tipo** e um **Impulso** da lista oficial de Dungeon World (ex: Hordas, Inimigos Arcanos, Organizações Ambiciosas, etc.). **Não invente impulsos.**\n     * **Vínculo com Local:** Ao descrever o perigo, cite onde ele está operando ou qual local da lista_locais ele ameaça diretamente.\n\n**Lista de Referência (Tipo: Impulso):**\n\n* **Organizações Ambiciosas:**\n  * *Culto:* Infestar a partir de dentro.\n  * *Governo Corrupto:* Manter o status quo.\n  * *Cabala:* Absorver aqueles que estão no poder, crescer.\n  * *Organização Religiosa:* Estabelecer e seguir doutrinas.\n* **Hordas:**\n  * *Criaturas Humanoides (ex: Orcs, Goblins):* Crescer, multiplicar e consumir.\n  * *Habitantes do Submundo:* Defender seus complexos de forasteiros.\n  * *Praga de Mortos-Vivos:* Espalhar.\n* **Inimigos Arcanos:**\n  * *Lorde Morto-Vivo:* Buscar a verdadeira imortalidade.\n  * *Mago Louco por Poder:* Buscar poder mágico a qualquer custo.\n  * *Dragão:* Reunir ouro e joias, proteger sua ninhada.\n* **Lugares Amaldiçoados:**\n  * *Portal das Trevas:* Expelir demônios/monstros.\n  * *Lugar de Poder:* Ser controlado ou domado.\n* **Forças Planares:**\n  * *Deus:* Reunir seguidores.\n  * *Força do Caos:* Destruir qualquer semblante de ordem.\n3. **Definição do Desastre Iminente:**\n   * Defina o \"Game Over\" narrativo. O que acontece se os jogadores falharem completamente?\n   * Escolha um Tipo de Desastre: Tirania, Pestilência, Destruição, Usurpação, Empobrecimento, Caos.",
    "user": "### 1. Estrutura da Frente (Fase 1)\n* **Gênero:** {{genre}}\n* **Subgêneros:** {{subgenres}}\n* **Escopo Geográfico:** {{scope}}\n* **Arquétipo:** {{step1_arquetipo}}\n* **Foco Narrativo (Atmosfera Central):** {{step1_foco}}\n* **Locais Disponíveis (O Palco):**\n{{#each step1_locais}}\n  - **{{this.nome}}** ({{this.funcao}}): {{this.tags}} - {{this.descricao}}\n{{/each}}\n\n### 2. Contexto da Trama\n* **Argumento:** {{argumento}}\n* **Premissa Evidente:** {{premissas.evidente.texto}}\n* **Premissa Oculta:** {{premissas.oculta.texto}}\n\n### 3. Opções de Criação\n* **Arquétipos de Personagens Permitidos:** {{arquetipos_personagens_permitidos}}\n\nAgora, povoe este mundo. Crie a descrição da frente, o elenco, os perigos (vinculados aos locais) e o desastre iminente."
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "descricao_frente": {
        "type": "string",
        "description": "Resumo do conflito central e atmosfera."
      },
      "elenco": {
        "type": "array",
        "description": "Lista de NPCs e Factions.",
        "items": {
          "type": "object",
          "properties": {
            "nome": {
              "type": "string"
            },
            "papel_funcao": {
              "type": "string"
            },
            "detalhe_marcante": {
              "type": "string",
              "description": "Algo visual ou de personalidade."
            }
          },
          "required": [
            "nome",
            "papel_funcao",
            "detalhe_marcante"
          ]
        }
      },
      "perigos": {
        "type": "array",
        "description": "Ameaças ativas (2 ou 3).",
        "items": {
          "type": "object",
          "properties": {
            "nome": {
              "type": "string"
            },
            "tipo": {
              "type": "string",
              "description": "Ex: Horda, Inimigo Arcano, etc."
            },
            "impulso": {
              "type": "string",
              "description": "O impulso oficial correspondente."
            },
            "local_vinculado": {
              "type": "string",
              "description": "Qual local da lista ele ocupa ou ameaça."
            },
            "descricao": {
              "type": "string",
              "description": "Descrição da ameaça em ação."
            }
          },
          "required": [
            "nome",
            "tipo",
            "impulso",
            "local_vinculado",
            "descricao"
          ]
        }
      },
      "desastre_iminente": {
        "type": "object",
        "description": "O Game Over narrativo.",
        "properties": {
          "tipo_desastre": {
            "type": "string",
            "enum": [
              "Tirania",
              "Pestilência",
              "Destruição",
              "Usurpação",
              "Empobrecimento",
              "Caos"
            ]
          },
          "descricao": {
            "type": "string",
            "description": "O que acontece se nada for feito."
          }
        },
        "required": [
          "tipo_desastre",
          "descricao"
        ]
      }
    },
    "required": [
      "descricao_frente",
      "elenco",
      "perigos",
      "desastre_iminente"
    ]
  }
}